from random import randint
import requests as req
import json
from Crypto.Util.number import long_to_bytes, bytes_to_long

import time

URL = "http://130.192.5.212:6522"
session = req.Session()

local_time = int(time.time())
r = session.get(f"{URL}/login", params={"username":"b"*10, "admin": 1})
data = r.json()
nonce, cookie = data["nonce"], data["cookie"]
cookie_bytes = long_to_bytes(cookie)

# cookie = "username=bbbbbbbbbb&expires=__________&admin=1"
expire_date = local_time + 30 * 24 * 60 * 60 # 30 days of time
pos = 31
new_val = long_to_bytes(int(str(expire_date)[3]) - 1)
cookie_edt_bytes = cookie_bytes
cookie_edt_bytes[pos] = cookie_bytes[pos] ^ long_to_bytes(expire_date)[3] ^ new_val

# new_ciphertext_byte = old_ct_byte ⊕ old_pt_byte ⊕ new_pt_byte
cookie_edt = bytes_to_long(cookie_edt_bytes)

r = session.get(f"{URL}/flag", params={"cookie": cookie_edt, "nonce": nonce})
print(r.content)
