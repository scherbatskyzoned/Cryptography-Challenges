from pwn import *
from Crypto.Util.strxor import strxor

leak = "mynamesuperadmin".encode()

pt_bytes = b"A" * 16
pt_hex = pt_bytes.hex()


# IV = bytes(l^p for l,p in zip(leak, pt_bytes))
# IV_hex = IV.hex()


HOST = "130.192.5.212"
PORT = 6523

if __name__ == '__main__':
    server = remote(HOST, PORT)

    server.sendlineafter(b"> ", b"enc")
    server.sendlineafter(b"> ", pt_hex.encode())

    IV_bytes = bytes.fromhex(server.recvline().decode().strip().split()[-1])
    ct_bytes = bytes.fromhex(server.recvline().decode().strip().split()[-1])

    fake_IV = strxor(strxor(IV_bytes, pt_bytes), leak)
    server.sendlineafter(b"> ", b"dec")

    server.sendlineafter(b"> ", ct_bytes.hex().encode())
    server.sendlineafter(b"> ", fake_IV.hex().encode())

    # Leggi risposta
    print("\nðŸ“¥ Risposta dal server:\n")
    while True:
        try:
            line = server.recvline(timeout=2).decode()
            print(line.strip())
        except:
            break

    server.close()